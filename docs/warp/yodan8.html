<HTML>
<HEAD><TITLE>YODAN part 8 of NYAOS</TITLE></HEAD>
<BODY bgcolor="#000000" text="#FFFFFF" link="#00FF00" vlink="#00AA00" alink = "#FF0000">
<TABLE BORDER=10>
<TR><TD><FONT SIZE=+2>葉山文書</FONT><BR>1/15〜l2/9の破局篇</TD>
</TABLE>
</CENTER>
<UL>
  <li> <a href="#onepage">とりあえず、1ページ</a>(3/1)
  <li> <a href="#chimatsuri">3月2日は血祭</a>(2/28)
  <li> <a href="#newurl">New URL</a>(2/27)
  <li> <a href="#icanna">いかんなー</a>(2/22)
  <li> <a href="#vector">Vector Design</a>(2/21 其の弐)
  <li> <a href="#install">install</a>(2/21 其の壱)
  <li> <a href="#cache">cache</a>(2/20)
  <li> <a href="#1.35">NYAOS 1.35</a>(2/18)
  <li> <a href="#NYAOS-II">NYAOS-II</a>(2/17)
  <li> <a href="#foreach">foreach</a>(2/12)
</UL>
<img alt="▽" src="/www-mpe.cheme.kyoto-u.ac.jp_hayama/img/s11.gif"><a href="yodan.html">目次へ</a>

<HR>

<h3><a name="onepage">とりあえず、1ページ</a>(3/1)</h3>

むっちゃ、忙しいのだが、こういう時にも、ちょっと息抜きをしたくなる
(お前は、いつも息を抜いているだろうが)。
というわけで、ベクターの方に<a href="http://www.vector.co.jp/authors/VA009797/">扉ページ</a>
だけを作った。内容もこちらとさほど違わないので、まだ見てもおもしろくありません。
とりあえず、シグニチャーの Web Address をこっちに書き変えた。
ただ、NYAOS のことは研究室の人には(マジで)秘密だから、
身内の人には、まだこのシグニチャーは使えん。
<P>
ああ、あした発表ではないか。質問に対する解答とか考えなきゃいけないし、
第一、台詞をまだ覚えてないではないか。
しかし、自分の表現力の無さには改めて驚く限りだ。
我が師、大嶋助教授も、あきれはてておられた(に違いない、え、今日に始まったことではないって)。
<P>
どうやら、日本語は、僕にとっては、第一外国語のようである(母国語はＣ言語か？)。
この文章一つとっても、「です・ます」調と「だ・である」が混在しているし。

<HR>

<h3><a name="chimatsuri">3月2日は血祭</a>(2/28)</h3>

3月3日は雛祭、3月2日は血祭り。そう、修論の発表会なのです。
うちは、修論の提出より前に先に発表があるんです。
やぁー、いそがしい、いそがしい(こう書くとなにか、嘘くさい)。
<P>
EUC の半角カタカナの件、ありがとさんです ＞ Romy さん。<BR>
しかし「かんにゃおす」は、いつになったら完成するのだろう(って誰に言っているんだ)
「かんにゃおす」が完成したら、いつかはＳＫＫをサポートした
「すけにゃおす」に挑戦したいものだ(名前のセンスが非常ーにわろし)。
<P>
変換型のファイル名補完(TABを何回もたたくやつ)をサポートできないか
というリクエストを受けてしまった。
一見、tcsh準拠路線を走っているかのような NYAOS だが、
その実態は「便利そうなら何でも取り入れちゃえ」という混沌思想だったりするので、
当然、売られた喧嘩は買わなきゃ、後がこわいのである(ナニカチガウ)。

<HR>

<h3><a name="newurl">New URL</a>(2/27)</h3>

ベクターデザインから、封書が届きました。
4月以降の本ページの新しいアドレスは<BR>
<BLOCKQUOTE>
http://www.vector.co.jp/authors/VA009797/<BR>
</BLOCKQUOTE>
となります。タイトルは「新・はやまったページ」という
非常に安直な名前にしてしまいました。
なお、今のところ、何にも置いておりませんので、
あわてて OPEN しないように。
「Under construction」しか無いと思います。
そのうち、ftp で本ページを順次コピーしていこうと思います。
<P>
しかし、ベクターデザインって、非常によい印象がありますね。
何の得もないのに、ソフト作者にページを割いてくれるところなど、
ソフト作者をこけにしてくれる窓の杜とえらい違いですね。
そういえば、これって Netscape と Microsoft の関係にも似てますね。
Netscape は何やら負けそうな雰囲気ですが、ベクターデザインには負けて欲しくないなぁ。
窓の杜は、OS/2 のソフトなんて、取り扱ってくれそうもないし。
<P>
「かんにゃおす」はカーソルキーがぼちぼち効くようになりました。
けれど、今だに、半角カタカナを入力できません。
EUC で、半角カタカナって、どういうコードで表すんだっけ。
2 bytes だというのは知ってるんだけど...
しかし、canna.a をスタティックリンクしただけで、
実行ファイルの大きさが爆発してしまった。
canna.dll ってないのかなぁ。<BR>
<BLOCKQUOTE>
(補足)<BR>
これって8倍になってたんですけれども、原因は「-g」を付けてコンパイルしたせいでした。
実際には3倍程度しか膨れませんので、爆発ってほどではありません。
canna.dll については、上野 博さんがすでに作って、
現在、(Mule 用に)テスト中だとのことです。どうも、ありがとうございました。<BR>
</BLOCKQUOTE>
<P>
なお、最近、あれが分からん、これが分からんとか、ほざきまくっていますが、
皆様余り気になさらないで下さい。単に調査をさぼっているだけなので...
最近、だんだん、根性無しになってゆく自分が実感できます。
なさけなー。
<P>
ああ、某友人の濱村君(どこが某だ)が、ウテナのビデオの続きを貸してくれた。
う〜ん、どうも、はまってしまったようだ。
まったく、こうなったのは、全て濱村君と山地氏とRomy氏の責任だぁぁぁぁ(なぜ、Romy氏!?)。
4年間、TVless の生活をして、せっかくその道から足を洗ったのにぃぃぃぃ。
このままでは NYAOS のアイコンがくるくる周る GIF アニメを作ってしまうぢゃないか(おい！)
<P>
あと、3時間以内に、発表の OHP と原稿を完成させねばならない。
だいたいできているが、原稿の量がちょっと、発表時間に比べて少ない。
なんとかしなくては。

<HR>

<h3><a name="icanna">いかんなー</a>(2/22)</h3>

<P ALIGN=CENTER>
<FONT COLOR=YELLOW SIZE=+1>「かんなをサポートせにゃ、いかんなー」</FONT>
</P>
という「<FONT COLOR=#FF00FF>さぶーい</FONT>」ギャクは置いといて(実は言いたくて仕方なかったという説有り)、
でけたでけたでけたでけたー。「かんな」でけたー、７割ほど(何やそれ)。
<P>
ということで、かんなクライアント版 NYAOS「かんにゃおす」が７割ほどできました。
７割といっても漢字変換には何ら支障がありません。
ただ、NYAOS と canna.a との、コードの扱いの違いから
<ul>
  <li> カーソルキーとかが全く効かない。
  <li> 半角かなに変換できない。
</ul>
というバグがまだとれてないんすよねー。
まぁ、もっぱら、コントロールキーしか使わない UNIX/tcsh ファンには
関係ない話かもしれませんが。
<P>
で、いつもなら、予告だけで終ってしまうのですが、ちょっと、調子に乗って、
スナップショットを公開してしまいます。他のバグチェックもほとんど
してませんし、ドキュメントもありません。
<P ALIGN=CENTER>
<a href="./cannyaos.zip"><TT>306890 Feb 22 21:01 cannyaos.zip</TT></a>
</P>
バージョンは「1.35'」とありますが、正式リリースではありません。
よって、二次配布は禁止ですんで(誰もしないって)。
なるべく、早く 1.36 として正式リリースしますので。
<P>
あ、当然、cannaserver とかがちゃんと走ってないと駄目っすよ。
環境変数 cannahost の定義も忘れないように。

<HR>

<h3><a name="vector">Vector Design</a>(2/21 其の弐)</h3>

このページの移転先のことですが、ベクターデザインがフリーソフトウェア作者に
ページを無料貸与してくれるそうですので、先程、メイルで申し込みました。
<P>
最初、問い合わせ先が、hpinfo@vector.co.jp だったので、
メイルで問い合わせたら、一瞬で daemon さんからの返事が返ってきた。
ううむ、丁寧にメイル書くのに30分ほどかけたのが無駄に終ってしまった(笑)
<P>
返事を見ると、無料で5MBまで貸与してくれるとのこと。
「いや、はやまったページ」は要らんものを除けば、
2MB前後なので余裕である。画像が無いからね。
というわけで、申し込みのメイルをフォーマットに従って送った。
<P>
就職したら、メイルアドレスは絶対にもらえるだろうし、upload も何とかなるだろう。
しかし、広告掲載の義務なしに、ページを貸してくれるとは、
ベクターデザインは太っ腹だねぇ。
フリーソフトウェア作者全員に書籍を贈ったり、
「なんとかの杜」にベクターの爪のあかを煎じて飲ませたいよ。
うんうん。

<HR>

<h3><a name="install">install</a>(2/21 其の壱)</h3>

発表要旨にようやくＯＫが出た。月曜早朝に差し換えに行かなくては、トホホ。
<P>
UNIX用 vim with skkfep を見付けたので、Solaris にインストールしようと思ったが、
うまくゆかーん。skkserv も skkfep もコンパイルはうまくいったが、
パッチあてた vim のコンパイルがうまくいかない(パッチ当ての手続きも複雑だし)。
ソース配布っつーのは、フリーソフトウェアの発展にはすごく貢献しているのだが、
いかんせん、インストールが面倒ですなぁ...
<P>
rmclone で zip/lzh アーカイブの中まで見にいくよう改造しようとしたが断念。
アーカイブの中まで見に行くのを前提に始めから作り直さなきゃならんようです。
Hashクラスを作ったことだし、C++ で書いた方がいいかなぁ...
<P>
「nyaos -c open &quot;Program Files&quot;」がうまくいかないというバグは、
簡単に直った。手抜きだったんだが、まさか外部から open を使うことなんて
思ってもいなかったから(open.exe とか open.cmd とか使うと思ったし)。
ところで、open といえば「送る」メニューに NYAOS を登録すると、任意のフォルダーから
NYAOS を起動できます。これと open を併用すると、WPS とコマンドラインを
行ったりきたり...って何が楽しいねん(笑)
<P>
OS/2 と Solaris とのファイル交換に、フロッピーを tar でテープのように使う事を
考えている。これなら、長いファイル名も問題無しだし、
マルチボリューム機能があって便利である。
しかし、ファイル一覧見るのがむっちゃ遅いのは困ったもんだ。
やっぱ、やめとこかなぁ。
簡単なリネームバッチを作るような、シェルスクリプトでも作った方が得策かなぁ...
しかし、フロッピーのファイルが 8+3 文字しか使えないのは、DOS の罪だよなぁ。
それともキルドール(だったっけ)の呪いかな。

<HR>

<h3><a name="cache">cache</a>(2/20)</h3>

いやはや、今日は修論発表要旨の締切で、こんなもん書いている場合ではないんですが、
ちょっと気分転換に...
<P>
コマンドキャッシュが結構好評みたいで嬉しいです。
スクリプトのキャッシングについては、
今、拡張属性で解決しようかと企んでおります(というのは嘘で、実は今思いついた)。
<P>
それぞれのファイル(/usr/bin/hogehoge.plなど)に実行属性を
拡張属性で付けていては時間がかかって仕方がないので、
それらを含むディレクトリ(/usr/bin など)の方に、
スクリプト実行可能なファイルの一覧を含む拡張属性でも作っておけば、
かなりディスクアクセスが節約できるんではないかと考えております。
で、実行属性を付ける命令も用意すると。
他、実行可能性のある拡張子を環境変数で限定させるっつーのも
いいかもしれませんね。
<P>
何か御意見ありましたら、メイルくださいませ。
<HR>

<h3><a name="1.35">NYAOS 1.35</a>(2/18)</h3>

NYAOS 1.35 を Release しました。
前回はソースに getkey.c が抜けていて、あいすみませんでした。
今回はちゃんとコンパイルできるかチェックしましたんで。
<P>
ところで、本当はソースの方は tar + bzip2 にしたかったんですけど
(サイズがさらに2割くらい減る!)、
FAT に合うファイル名にできないんで、今回は見送りました。
<P>
Web Server への転送をフロッピーなんぞに頼っているために、
名前を 8+3 に抑えなくてはいけないんです。
Server が Warp ならよかったんですが、Solaris なんで、
宇野さんの LCP.CMD を使うわけにもいきませんし(Solaris は EA が分からん！)。
tar + bzip2 したものに、さらに tar して名前を変えるのもみっともないし。
ううむ。
<P>
gzip なら .tgz というサフィックスのものは、展開後 tar にしてくれるんですけど、
bzip2 はどうも絶対 .bz2 にしなくてはいけないようで。
gzip-2.0を待とうかな...
<BR>
＃ 何をつまらんこと、悩んでいるのやら(笑)
<p>
なお、bzip2 は奥西さんporting のものが、MAKOTO さんのページ:
<a href="http://netpassport-wc.netpassport.or.jp/~wmakoto/CLUB-bzip2.html"
>CLUB-bzip2</a>に置いてあります。

<hr>

<H3><a name="NYAOS-II">NYAOS-II</a>(2/17)</H3>

どうも、最近、更新頻度が下がってますなぁ。
putenv では、sukisuki をお騒がせしました。
Solaris と OS/2 emx では、putenv(&quot;HOGEHOGE&quot;)の動作が違ったのでした。
emx では、ちゃんと消えてくれるのです。
ううむ。同じ gcc だから同じだと思ったのにぃぃぃ。
清水さん、相沢さん、さとうさん、ありがとうございます。
<P>
ぼちぼち、1.35 を公開しようと思いつつ、ドキュメントを書く暇がなくて、
後まわし、後まわしにしていたら、いつの間にやら、前の Release から
一ヶ月経ってしまいました。なるべく今週中に出したいなぁ...
<P>
NYAOS は、パイプラインの作り方とかをよく知らなかったので、
CMD.EXE のプリプロセッサのような形で作りました。
でも、最近は pipe,dup,dup2,fork等の関数の使い方が分かりましたし、
一方で、プリプロセッサ形式にした事による、プログラムの見通しの悪さも
目立ってきました。
ですので、ここいらで CMD.EXE からの完全独立を中期的目標にしようと思います。
これを達成した暁には、バージョンナンバを 2.00 としてしまいます。
<P>
あくまで目標ですが、2.00 では次を実現したいと思います。
<ul>
  <li> 完全に CMD.EXE と replace 可能。上位互換を目指す。
  <li> 当然ながら、外部コマンドの起動が速くなる。
  <li> source 文の廃止。*.CMD 中での環境への操作は、呼び出した NYAOS にも
       ちゃんと反映される。
  <li> 不要な命令の削除。具体的には、comment,fg,bg,jobs,eadir など。
  <li> 「&amp;」や「|」,「;」で継いだ命令のどこに、内蔵コマンドを置いても
       ちゃんと認識される。
</ul>
まぁ、ユーザーから見たメリットちゅうのもあんまり無いし、
最初は 2.xx はバグだらけになるでしょうから、
当分は 1.xx のソースも別管理して、1.xx と 2.xx を並行して Release しようかと
思います。
<P>
しかし、eff さえ、未だ Release の見込みが無いのに、こんな宣言してしもて、
大丈夫なんかい。いくら、3月に時間ができるっつーてもねぇ...。
それにサラリーマンになってからでも、暇あるかなぁ。心配だぁぁぁ。

<HR>

<h3><a name="foreach">foreach</a>(2/12)</h3>

foreach での出力をリダイレクトやパイプに出力できるようになりました。具体的には
<PRE>
   foreach i *
       echo $i
   end | less
</PRE>
なんていう記述が可能になります。これって bash の for とかは出来たけど、
t?csh では出来なかったのではないでしょうか。
もちろん、foreach の引数にも逆クォートが使えます。
<P>
xterm に対応してから、Ctrl-C がまた効かなくなっています(直しましたが)。
また、ずっと、ソースパッケージに getkey.c を入れるのを忘れていました。
<P>
KI-Shell のドライブエイリアスみたいなものを入れようしました。
「drvalias z=j」なんてすると「z:」が「j:」と等価になるんですけど、
「cd z:/hogehoge」でカレントドライブを変更した時に、プロンプトを「z:」にできないんです
(cd が z: をキャッチする前に、j:へ置換されてしまう為)。
というわけで、機能的に中途半端なんで、カットしちまいました。
<P>
しかし、なんとか、95 と OS/2 でドライブ文字、統一できんもんかなぁー。
join/subst か tvfs を使うしか無い？！
<P ALIGN=CENTER>
   <FONT COLOR=YELLOW>≡★</FONT>
</P>
最近 Windows95 の方の環境をちょいと整備してます。
最近まで、Quake とか、ゲームする時しか利用していなかったんですけどね。
システム屋さん(<a href="http://www.tis.co.jp/">TIS</a>)に就職するとあっては、Windows をちょっとは学ばねばならぬと
思って、以前 95 をインストールしたんですが、DOS窓が死んでいたので、ずっと放っておりました。
が、昨日、CONFIG.SYS に \DOS\$ANSI.SYS と \WIN95\ANSI.SYS の両方が入っていた為であることが判明。
馬鹿なことしてたもんだ。
<P>
シェルは VFAT対応KI-Shell を入れたが、バインドがダイヤモンドカーソルだし、
補完が変換方式(目的のファイルが出るまで、何度も特定のキーを叩く。
tcsh とか NYAOS は限定補完方式)だし、どうも勝手が違う。
いや、慣れることはできると思うが、逆に OS/2&amp;Solaris に戻る時に混乱してもねぇ。
tcsh は入れてみたこともあるが、どうも VFAT でないファイル名を補完する時に
大文字で頭文字を打たねばならぬのが、ちょいと面倒なんでパスしました。
<P ALIGN=CENTER>
   <FONT COLOR=YELLOW>≡★</FONT>
</P>
LONGNAME をプロンプトで表示させるという機能を付けたと先日書きましたが、えらいバグを見付けました。
カレントドライブが CD-ROM だと、LONGNAME が存在しないはずなのに、
最近にキャッチした他所の LONGNAME を、そのディレクトリの LONGNAME と勘違いしてしまうのです。例えば
<PRE>
    D:/Program Files[127] cd J:/OS2MAG/
    J:/Program Files[128]
</PRE>
なんて、表示されてしまいます(J:はCD-ROMのドライブ文字)。
<P>
いろいろと調べましたが、どうも CD-ROMドライブの場合のみであることから、
NYAOS ではなく、システムのバグだろうと思われます。
仕方が無いので、カレントドライブのファイルシステムを調べて、FAT(not CDFS)の時だけ、
LONGNAME を調べるようにしました。やれやれだぜ。
<P>
関係ありませんけど、この LONGNAME のバグを調べるときに拡張属性を得るライブラリ関数
_ea_get のソースを見ました。以前、平松さんが、拡張属性のサイズを得る方法が無いと、
どこかでおっしゃっていたのを耳^H目にしていたので、どうやってるのかなぁと思ったら...
<PRE>
    p = alloca( 0x10000 ); /* 本当は、もうちょっと複雑です */
</PRE>
やるな、ブライト。いや、確かに 64KB 以上の大きさの拡張属性は無いです。はい。
<P ALIGN=CENTER>
<FONT COLOR=YELLOW>≡★</FONT>
</P>
rmclone で、アーカイブの中まで検索させようと考えているのですが、
なるべくテンポラリファイルなど使いたくありません。
そこで、RXQUEUE ってコマンドを使おうと思うのですが、
これって、全ての OS/2 にあるんでしょうかねぇ。
いや、どっかの REXX Script で使っていたと思うんですが、
<PRE>
     'コマンド | RXQUEUE'
</PRE>
なんていうのを使うと、どうも(無名)キューの中にコマンドの標準出力が push されるようなのです。
でも、素直に REXX にパイプなどを加える DLL とかを使った方がいいかな...
<P>
あとマルチボリュームなんかもサポートしたいですね。
ZipDrive なんかを使っていると、あちらこちらに同じファイルが複製されて困りますからね。
<P>
そうそう、REXX のまともな本を図書館で見付けたので、大学生の必殺技、
全ページコピーをしてしまいました(著作権って言葉知ってんのか!?)。
これで、REXX のツールに関して、開発効率が上がるかも!?

<HR>
<img alt="▽" src="/www-mpe.cheme.kyoto-u.ac.jp_hayama/img/s11.gif"><a href="yodan7.html">さらに過去の余談へ</a>
</BODY>
</HTML>
